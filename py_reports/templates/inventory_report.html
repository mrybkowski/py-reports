{% extends "base.html" %} {% block content %}
<div class="report-content">
  <!-- Report Title -->
  <h1>{{ t('report.inventory.title') }}</h1>

  <!-- Summary Statistics -->
  {% if report.main_data.table.totals %}
  <div class="summary mb-4">
    <h3>{{ t('common.totals') }}</h3>
    <table class="table">
      <tbody>
        <tr>
          <td><strong>{{ t('common.total_items') }}</strong></td>
          <td class="text-right">
            {{ report.main_data.table.totals.stock_quantity.sum|number }}
          </td>
        </tr>
        <tr>
          <td><strong>{{ t('common.total_value') }}</strong></td>
          <td class="text-right">
            {{ report.main_data.table.totals.total_value.sum|currency('PLN') }}
          </td>
        </tr>
        <tr>
          <td><strong>{{ t('common.average_value') }}</strong></td>
          <td class="text-right">
            {{ report.main_data.table.totals.total_value.avg|currency('PLN') }}
          </td>
        </tr>
        <tr>
          <td><strong>{{ t('common.product_count') }}</strong></td>
          <td class="text-right">
            {{ report.main_data.table.totals.stock_quantity.count|number }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Main Data Table -->
  {% if report.main_data.table %}
  <div class="table-container">
    <h3>{{ t('report.inventory.title') }}</h3>
    <table class="table">
      <thead>
        <tr>
          {% for header in report.main_data.table.headers %}
          <th class="{{ header.align }}">{{ t(header.label) }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in report.main_data.table.rows %}
        <tr>
          {% for header in report.main_data.table.headers %}
          <td class="{{ header.align }}">
            {{ row[header.field].formatted_value }}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Low Stock Warning -->
  {% if report.main_data.table.rows %} {% set low_stock_items = [] %} {% for row
  in report.main_data.table.rows %} {% if row.stock_quantity.raw_value < 10 %}
  {% set _ = low_stock_items.append(row) %} {% endif %} {% endfor %} {% if
  low_stock_items %}
  <div class="alert alert-warning mt-4">
    <h4>{{ t('common.low_stock_warning') }}</h4>
    <p>{{ t('common.low_stock_message', count=low_stock_items|length) }}</p>
    <ul>
      {% for item in low_stock_items[:5] %}
      <li>
        {{ item.product_name.raw_value }} - {{ item.stock_quantity.raw_value }}
        {{ t('common.units') }}
      </li>
      {% endfor %} {% if low_stock_items|length > 5 %}
      <li>... {{ t('common.and_more', count=low_stock_items|length - 5) }}</li>
      {% endif %}
    </ul>
  </div>
  {% endif %} {% endif %}

  <!-- Report Footer -->
  <div class="report-footer mt-5">
    <p class="text-muted">{{ t('footer.generated_by') }} - {{ now }}</p>
  </div>
</div>
{% endblock %}
